# Code Coverage Guide

## Overview
This project uses **Coverlet** for code coverage collection and **ReportGenerator** for HTML reporting.

## Current Coverage
- **Line Coverage**: 100% ✅ (98/98 lines)
- **Branch Coverage**: 100% ✅ (8/8 branches)
- **Method Coverage**: 100% ✅ (26/26 methods)

### Per-Component Coverage
- ✅ **EmployeeController**: 100%
- ✅ **WeatherForecastController**: 100%
- ✅ **Program**: 100%
- ✅ **ApplicationDbContext**: 100%
- ✅ **EmployeeDto**: 100%
- ✅ **Employee Entity**: 100%
- ✅ **WeatherForecast Entity**: 100%
- ✅ **MappingProfile**: 100%
- ⚪ **Migrations**: Excluded (auto-generated code)

## Test Summary
- **Total Tests**: 28
  - Unit Tests: 20
  - Integration Tests: 8
- **Pass Rate**: 100%

## Quick Start

### Run Tests with Coverage + HTML Report
```powershell
.\run-coverage.ps1
```
This will:
1. Run all tests (unit + integration)
2. Collect coverage data
3. Generate HTML report
4. Open report in browser

### Run Tests with Console Summary Only
```powershell
.\coverage-summary.ps1
```
Shows coverage summary in console without opening browser.

### Manual Commands
```powershell
# Unit tests only
cd tests\Sample1.Tests.Unit
dotnet test /p:CollectCoverage=true /p:CoverletOutputFormat=cobertura /p:CoverletOutput="..\..\TestResults\coverage.unit.xml"

# Integration tests only
cd tests\Sample1.Tests.Integration
dotnet test /p:CollectCoverage=true /p:CoverletOutputFormat=cobertura /p:CoverletOutput="..\..\TestResults\coverage.integration.xml"

# Generate HTML report
reportgenerator -reports:".\TestResults\*.xml" -targetdir:".\CoverageReport" -reporttypes:"Html"
```

## Coverage Reports Location
- **HTML Report**: `CoverageReport/index.html`
- **Text Summary**: `CoverageReport/Summary.txt`
- **Badges**: `CoverageReport/badge_*.svg`
- **Raw Data**: `TestResults/coverage.*.xml`

## Exclusions
**Migrations are excluded from coverage** because they are auto-generated by Entity Framework and typically not tested. The coverage scripts use `/p:ExcludeByFile="**\Migrations\*.cs"` to exclude these files.

If you want to include migrations in coverage, remove the exclusion parameter from the scripts.

## CI/CD Integration
Add to your CI pipeline:
```yaml
- run: dotnet test /p:CollectCoverage=true /p:CoverletOutputFormat=cobertura /p:ExcludeByFile="**\Migrations\*.cs"
- run: reportgenerator -reports:"**/*.cobertura.xml" -targetdir:"coverage"
```

## Maintaining High Coverage
Current status: **100% coverage achieved** ✅

To maintain this level:
1. Write tests for all new controllers and business logic
2. Test both happy paths and error scenarios
3. Exclude only auto-generated code (migrations, scaffolding)
4. Run coverage checks before merging PRs
5. Use the HTML report to identify uncovered lines

## Tools Used
- **coverlet.msbuild** (v6.0.4) - Coverage collection
- **coverlet.collector** (v6.0.0) - Data collector
- **ReportGenerator** (v5.5.1) - HTML reporting
